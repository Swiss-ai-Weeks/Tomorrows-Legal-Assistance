graph TD
    Start([Start]) --> Ingest[ğŸ”§ Ingest Node<br/>Normalize Input & Initialize Memory]
    Ingest --> Categorize[ğŸ·ï¸ Categorize Node<br/>Classify Case into Legal Category]
    
    %% Conditional branching based on category
    Categorize --> Decision{Category = 'Andere'?}
    Decision -->|Yes| AggregateSkip[ğŸ“Š Aggregate Node<br/>Return Category Only<br/>No Estimations]
    Decision -->|No| WinLikelihood[ğŸ¯ Win Likelihood Node<br/>ReAct Analysis with RAG & Historic Cases]
    
    %% Main analysis flow
    WinLikelihood --> TimeCost[â±ï¸ğŸ’° Time & Cost Node<br/>Business Logic Estimation]
    TimeCost --> AggregateFull[ğŸ“Š Aggregate Node<br/>Validate & Format Full Results]
    
    %% Both paths end
    AggregateSkip --> End([End])
    AggregateFull --> End
    
    %% Styling
    classDef startEnd fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef process fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef decision fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef aggregate fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    
    class Start,End startEnd
    class Ingest,Categorize,WinLikelihood,TimeCost process
    class Decision decision
    class AggregateSkip,AggregateFull aggregate
    
    %% Add notes
    Categorize -.->|"Categories:<br/>â€¢ Arbeitsrecht<br/>â€¢ Immobilienrecht<br/>â€¢ Strafverkehrsrecht<br/>â€¢ Andere"| Categorize
    WinLikelihood -.->|"Uses:<br/>â€¢ rag_swiss_law()<br/>â€¢ historic_cases()<br/>â€¢ Apertus LLM"| WinLikelihood
    TimeCost -.->|"Uses:<br/>â€¢ estimate_time()<br/>â€¢ estimate_cost()<br/>â€¢ Business Logic"| TimeCost